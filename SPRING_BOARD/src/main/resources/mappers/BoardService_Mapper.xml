<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezen.team.persistence.BoardService_Mapper">


<insert id="boardInsert" parameterType="HashMap">
insert into Board(bidx,orginbidx,updown,leftright,bsubject,bcontents,
bwriter,bpassword,bwriteday,bip,bdelyn) 
values(bidx_seq.nextval,bidx_seq.nextval,0,0,#{bsubject},
#{bcontents},#{bwriter},#{bpassword},sysdate,#{bip},default)
</insert>


<select id="boardselectAll" parameterType="scri" resultType="bvo">
<![CDATA[select C.* from (
		select B.* from (
			select Row_number() over(order by orginbidx desc,updown,bidx) rn, A.*
			from Board A where bdelyn='N' and  bsubject like '%'||#{keyword}||'%'	
			) B
		where B.rn <= #{pageEnd}) C
	where C.rn >= #{pageStart}
	]]>
</select>

<select id="boardTotal" parameterType="scri" resultType="Integer">
select count(*) from Board where bdelyn='N' 
and  bsubject like '%'||#{keyword}||'%'
</select>

<update id="boardView" parameterType ="Integer" >
update board set bview= nvl(bview,0)+1 where bidx=#{bidx} 
</update>

<select id="boardSelectOne" parameterType="Integer" resultType="bvo">
select * from board where bdelyn='N' and bidx= #{bidx}
</select>

<update id="boardUpdate" parameterType="HashMap">
update board set bsubject=#{bsubject},bcontents=#{bcontents},bwriter=#{bwriter} where bidx=#{bidx}
</update>

<update id="boardDelete" parameterType="HashMap">
update board set bdelyn='Y' where bidx=#{bidx} and bpassword=#{bpassword}
</update>

<update id="boardReplyUpdate" parameterType="Integer">
<![CDATA[ update board set updown = updown+1 where orginbidx=#{0} and updown>#{1} ]]>
</update>

<insert id="boardReplyInsert" parameterType="HashMap">
insert into board(bidx,orginbidx,updown,leftright,
bsubject,bcontents,bwriter,bpassword,bdelyn,
bip,bwriteday) 
values(bidx_seq.nextval,#{orginbidx},#{updown}+1,#{leftright}+1,#{bsubject},#{bcontents},#{bwriter},#{bpassword},default,#{ip},default)
</insert>

<update id="boardRecommend" parameterType="Integer">
update board set brecommend= nvl(brecommend,0)+1 where bidx=#{bidx}
</update>


<!-- 
<sql id="search">    
	    <if test="searchType != null and searchType.equals('writer')">	
			 and  bwriter like '%'||#{keyword}||'%'
		</if>	
		<if test="searchType != null and searchType.equals('subject')">	
			 and  bsubject like '%'||#{keyword}||'%'
		</if> 
    </sql> 
 -->

</mapper>